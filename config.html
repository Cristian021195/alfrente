<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuración</title>

    <!-- PWA -->
    <link rel="icon" type="image/svg+xml" href="./assets/icon.svg" />
    <link rel="manifest" href="./manifest.json" />
    <meta name="application-name" content="Al frente" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Al frente" />
    <meta name="description" content="App didactica para docentes, tomar listado de presentes y hacer pasar a alumnos" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="x5-page-mode" content="app">
    <meta name="browsermode" content="application">
    <meta name="msapplication-TileColor" content="#800080" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="theme-color" content="#800080" />
    <link rel="apple-touch-icon" href="./assets/icon.svg" />
    <link rel="apple-touch-icon" sizes="192x192" href="./assets/icon_192.svg" />
    <link rel="apple-touch-icon" sizes="256x256" href="./assets/icon_256.svg" />
    <link rel="apple-touch-icon" sizes="512x512" href="./assets/icon.svg" />    
    <link rel="mask-icon" href="./assets/icon.svg" sizes="any" type="image/svg+xml" color="#a340a3" />

    <link rel="stylesheet" href="./style.css">
    <script src="./app.js" defer></script>
    <style>#opciones{position: relative; bottom: 0; width: 100%;display: flex; align-items: center; padding-left: 1rem;}
    .flex{display: flex;}.w-100{width: 100%;}
    </style>
</head>
<body>
    <main class="main">
        <section class="p-1">
            <h1 id="alumno">Configuración</h1>
            <button class="btn-sm bg-green top-right" id="instalar" onclick="instalar()">Instalar</button>
            <br>
            <h2>Cargar alumnos manualmente</h2>
                <fieldset class="text-start box br1">
                    <legend class="br05">Formulario alumno</legend>
                    <form id="alumno_form">
                        <label for="nombre">Nombre</label>
                        <input class="br1" type="text" name="nombre" id="nombre" required minlength="3" maxlength="50">
                        <label for="apellido">Apellido</label>
                        <input class="br1" type="text" name="apellido" id="apellido" required minlength="3" maxlength="50">
                        <!--<label for="nombre">Apodo</label>
                        <input class="br1" type="text" name="apodo" id="apodo" required minlength="3" maxlength="50">-->
                        <div class="text-center">
                            <button type="submit" class="btn-sm bg-orange" id="btn_alumno">Cargar</button>
                        </div>
                    </form>
                </fieldset>
                <br>
                <h2>Cargar link de planilla</h2>
                <fieldset class="text-start box br1">
                    <legend class="br05">Link Google sheet</legend>
                    <form id="url_form">
                        <input class="br1" type="text" name="url" id="url" class="br1" required minlength="10" maxlength="600" placeholder="https://script.google.com...">
                        <div class="text-center">
                            <div id="loader" class="d-none">
                                <svg width="48" height="48" stroke="#f5f5f5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g><circle cx="12" cy="12" r="9.5" fill="none" stroke-width="3" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" calcMode="spline" values="0 150;42 150;42 150;42 150" keyTimes="0;0.475;0.95;1" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" repeatCount="indefinite"/><animate attributeName="stroke-dashoffset" dur="1.5s" calcMode="spline" values="0;-16;-59;-59" keyTimes="0;0.475;0.95;1" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" repeatCount="indefinite"/></circle><animateTransform attributeName="transform" type="rotate" dur="2s" values="0 12 12;360 12 12" repeatCount="indefinite"/></g></svg>
                            </div>
                            <button type="submit" class="btn-sm bg-orange" id="btn_url">Cargar</button>
                        </div>
                    </form>
                </fieldset>
                <fieldset class="text-start box br1">
                    <legend class="br05">Tamaño de nombre </legend>
                    <form id="cfg_form">
                        <div class="flex">
                            <label for="sm" class="w-100">Tamaño pequeño: </label>
                            <input type="radio" name="fs" value="sm" id="sm">
                        </div>                        
                        <div class="flex">
                            <label for="md" class="w-100">Tamaño mediano: </label>
                            <input type="radio" name="fs" value="md" id="md">
                        </div>
                        <div class="flex">
                            <label for="lg" class="w-100">Tamaño grande: </label>
                            <input type="radio" name="fs" value="lg" id="lg">
                        </div>
                    </form>
                </fieldset>
                <button type="button" class="btn-sm bg-orange" id="btn_borrar">Borrar todos los alumnos</button>
                <br>
        </section>
        <div class="d-flex between" id="opciones">
            <a href="../" class="opbtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
                </svg>
            </a>
        </div>
    </main>
    <script>
        const $btn_alumno = document.getElementById('btn_alumno');
        const $nombre = document.getElementById('nombre');
        const $apellido = document.getElementById('apellido');
        //const $apodo = document.getElementById('apodo');
        const $url = document.getElementById('url');
        const $btn_url = document.getElementById('btn_url');
        let _alumnos = JSON.parse(localStorage.getItem('alumnos') || '[]');
        const $alumno_form = document.getElementById('alumno_form');
        const $url_form = document.getElementById('url_form');
        const $loader = document.getElementById('loader');
        const $btn_borrar = document.getElementById('btn_borrar');
        const $cfg_form = document.getElementById('cfg_form');
        let fs = localStorage.getItem('fs') || 'sm';

        document.getElementById(fs).setAttribute('checked',true);

        $alumno_form.addEventListener('submit', (e)=>{
            e.preventDefault();
            _alumnos.push([$nombre.value, $apellido.value])
            localStorage.setItem('alumnos', JSON.stringify(_alumnos));
            alert('Agregado');
            $alumno_form.reset();
        });

        $url_form.addEventListener('submit', async (e)=>{
            e.preventDefault();
            $loader.classList.remove('d-none');
            $btn_url.classList.add('d-none');
            try {
                const pet = await fetch($url.value);
                if(pet.status >= 200 && pet.status < 300){
                    const data = await pet.json();
                    const alumnos = data.cuerpo;
                    localStorage.setItem('alumnos', JSON.stringify(alumnos));
                    localStorage.setItem('link', $url.value);
                    alert('¡Planilla agregada!')
                }else{
                    alert('Error el link debería ser similar a https://script.google.com... ');
                }
            } catch (error) {
                alert('Error el link debería ser similar a https://script.google.com... ');
            }finally{
                $loader.classList.add('d-none');
                $btn_url.classList.remove('d-none');
            }

            $url_form.reset();
        });

        $btn_borrar.addEventListener('click', ()=>{
            let confirm = window.confirm("¿Borrar datos?");
            if(confirm){
                _alumnos = [];
                localStorage.removeItem('alumnos');
                localStorage.removeItem('link');
            }            
        })

        $cfg_form.addEventListener('change',(e)=>{
            localStorage.setItem('fs', e.target.value);
        })

    </script>
</body>
</html>